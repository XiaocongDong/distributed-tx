*** Settings ***
Suite Setup
Library           RequestsLibrary
Library           Collections

*** Variables ***
@{auth}           admin    admin
${ip}             localhost
${port}           8181
@{operations}     PUT    MERGE    DELETE

*** Test Cases ***
datastore test case
    log    DTx DataStore Normal Test
    : FOR    ${operation}    IN    @{operations}
    \    log    "DTx DataStore ${operation} Test"
    \    DTx DataStore Test    ${operation}    10    10    10
    log    DTx DataStore \ Rollback Test
    : FOR    ${operation}    IN    @{operations}
    \    log    "DTx DataStore rollback ${operation} Test"
    \    DTx DataStore Test    ${operation}    10    10    10    true

mixedprovider test case
    log    MixedProvider normal test
    : FOR    ${operation}    IN    @{operations}
    \    log    Mixed provider normal ${operation} test
    \    DTx MixedProvider Test    ${operation}
    log    MIxedProvider rollback test
    : FOR    ${operation}    IN    @{operations}
    \    log    Mixed provider rollback ${operation} test
    \    DTx MixedProvider Test    ${operation}    1    4    true

netconf test case
    log    netconf normal test
    : FOR    ${operation}    IN    @{operations}
    \    log    Netconf normal ${operation} test
    \    DTx Netconf Test    ${operation}
    log    netconf rollback test
    : FOR    ${operation}    IN    @{operations}
    \    log    Netconf rollback ${operation} test
    \    DTx Netconf Test    ${operation}    1    4    true

*** Keywords ***
DTx DataStore Test
    [Arguments]    ${operation}=PUT    ${outerList}=10    ${innerList}=10    ${putPerTx}=1    ${performRollback}=false
    [Documentation]    This keyword is used to do the datastore test for DTx
    ${postheader}    Create Dictionary    content-type    application/json    Accept    application/json
    ${url}    Set Variable    http://${ip}:${port}/restconf/operations/distributed-tx-it-model:datastore-test
    ${Input}    Set Variable    {"input":{"operation":${operation},"putsPerTx":${putPerTx},"outerList":${outerList},"innerList":${innerList},"performRollback":${performRollback}}}
    Create Session    DatastoreTestSession    ${url}    auth=@{auth}
    ${resp}    Post Request    DatastoreTestSession    /post    data=${input}    headers=${postheader}
    Should Be Equal As Strings    ${resp.status_code}    200
    Should Contain    ${resp.content}    OK

DTx MixedProvider Test
    [Arguments]    ${operation}=PUT    ${putsPerTx}=1    ${numberOfTxs}=4    ${performRollback}=false
    [Documentation]    This keyword is used to do the mixedProvider Test for DTx
    ${postheader}    Create Dictionary    content-type    application/json    Accept    application/json
    ${url}    Set Variable    http://${ip}:${port}/restconf/operations/distributed-tx-it-model:mixed-provider-test
    ${input}    Set Variable    {"input":{"operation":${operation},"putsPerTx":${putsPerTx},"numberOfTxs":${numberOfTxs},"performRollback":${performRollback}}}
    Create Session    MixedProvidertestSession    ${url}    auth=@{auth}
    ${resp}    Post Request    MixedProviderTestSession    /post    data=${input}    headers=${postheader}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    200
    Should Contain    ${resp.content}    OK

DTx Netconf Test
    [Arguments]    ${operation}=PUT    ${putsPerTx}=1    ${numberOfTxs}=4    ${performRollback}=false
    [Documentation]    This keyword is used to do the netconf Test for DTx
    ${postheader}    Create Dictionary    content-type    application/json    Accept    application/json
    ${url}    Set Variable    http://${ip}:${port}/restconf/operations/distributed-tx-it-model:netconf-test
    ${input}    Set Variable    {"input":{"operation":${operation},"putsPerTx":${putsPerTx},"numberOfTxs":${numberOfTxs},"performRollback":${performRollback}}}
    Create Session    NetconfTestSession    ${url}    auth=@{auth}
    ${resp}    Post Request    NetconfTestSession    /post    data=${input}    headers=${postheader}
    log    ${resp.content}
    Should Be Equal As Strings    ${resp.status_code}    200
    Should Contain    ${resp.content}    OK
